# 限流

## 服务部署

- 每个机房有10台服务，独立部署限流服务
- 限流服务器ip为倒数第二位为32，倒数第一位在[11, 21]区间
-  


## 限流请求隔离

> 关于限流增加请求系统隔离的需求，一开始就进入一个不合适的坑中（引入限流字段）。后续所有的思路都在这个字段上做文章。其实限流本身已经可以实现进行请求系统隔离。为什么，把请求系统当作限流指令的一个维度，跟平时设置限流指令时类似。不对请求系统做任何的特殊对待。


## 通过执行lua脚本进行限流判断

> 初始化的时候，会将工程中的lua脚本文件加载到redis缓存，并生成唯一的sha1值，
这样后面在执行lua脚本的时候无需每次都要重新加载，直接根据sha1值，并传入lua脚本中需要的参数，即可快速执行lua脚本

## 限流过程

- 传入参数：

- 参数组装：

- 策略查询


## 初始化过程
- 脚本加载初始化
- 缓存初始化
- 刷新配置


## 策略缓存