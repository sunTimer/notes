# 1. 需求
## 1.1 专线探测
专线探测任务需调用`basedata`接口，`basedata`数据库有两个：主库和备库。当主库宕机时，会由DBA将备库切换为主库。而专线探测任务调用basedata接口中的配置中，读任务默认为本地`local`库，即读取该任务-该机房-该数据库，而写任务调用的`basedata`是写死在配置文件中，默认为`10`机房的主库。因此，这导致主库宕机之后，专线探测并无感知，依然会往主库发送写任务。

```
需要依赖梦岚提供的接口，该接口提供当前主库的信息。梦岚未开发完，这边可以同步开发。
```

## 1.2 单条专线配置告警
在机构专线配置方面，按照'机构-机房-业务'维度来配置，经查询，发现大量存在只配置一根专线的情况。从业务角度考虑，不应该出现只配一根专线。当这种情况发生时，专线探测任务不会对这些专线进行切换，也就是说为保证业务不断，即使探测到该条专线不稳定或者直接不通，专线探测任务依然不会对其切量。为改善这一问题，提出两种需求:

* 对当前已经存在的单条专线配置，定期扫描，发布告警
* 运营在配置专线时，在界面进行校验，不允许只配值一根专线。
 
```
 目前只考虑需求`1`。另外该需求为`basedata`需求，需要在`basedata`模块进行开发
```

# 2. 方案
## 2.1 专线探测
暂时考虑的两种方案
1. 配置文件中加入备库的zk地址，写一个定时任务，定期调用接口（该接口可以获取当前主库的信息），获取主库信息，并及时进行zk地址的切换，
2. 鉴于配置文件不够灵活，日后若加入其他信息，仍需要重启服务，考虑在表中对该zk地址信息进行维护。

```
最终采取的方案，还在确定中
```

## 2.2 单条专线配置告警
basedata中开发定时任务，定期扫描，异步通知


# 3. 任务排期
- 开发: 
    - `6.25-6.26`：专线告警
    - `6.26-6.27`：专线主备库切换
- 测试：`6.28`
- 代码评审：`6.28`
- 上线：`6.30`后（具体待定）